{"version":3,"sources":["../../routes/file.js"],"names":["RESP","express","require","router","Router","multiparty","util","fs","post","req","res","next","form","Form","encoding","uploadDir","maxFilesSize","parse","err","fields","files","filesTmp","JSON","stringify","onFileUploadError","console","log","inputFile","uploadedPath","path","dstPath","originalFilename","rename","onSuccess","module","exports"],"mappings":";;AAAA;;IAAYA,I;;;;AAEZ;AACA,IAAIC,UAAUC,QAAQ,SAAR,CAAd;AACA;AACA,IAAIC,SAASF,QAAQG,MAAR,EAAb;AACA,IAAIC,aAAaH,QAAQ,YAAR,CAAjB;AACA,IAAII,OAAOJ,QAAQ,MAAR,CAAX;AACA,IAAIK,KAAKL,QAAQ,IAAR,CAAT;;AAEA;AACAC,OAAOK,IAAP,CAAY,SAAZ,EAAuB,UAAUC,GAAV,EAAeC,GAAf,EAAoBC,IAApB,EAA0B;AAC7C;AACA,QAAIC,OAAO,IAAIP,WAAWQ,IAAf,EAAX;AACA;AACAD,SAAKE,QAAL,GAAgB,OAAhB;AACA;AACAF,SAAKG,SAAL,GAAiB,sDAAjB;AACA;AACAH,SAAKI,YAAL,GAAoB,IAAI,IAAJ,GAAW,IAA/B;AACA;AACA;AACA;AACAJ,SAAKK,KAAL,CAAWR,GAAX,EAAgB,UAAUS,GAAV,EAAeC,MAAf,EAAuBC,KAAvB,EAA8B;AAC1C,YAAIC,WAAWC,KAAKC,SAAL,CAAeH,KAAf,EAAsB,IAAtB,EAA4B,CAA5B,CAAf;;AAEA,YAAIF,GAAJ,EAAS;AACLlB,iBAAKwB,iBAAL,CAAuBd,GAAvB;AACAe,oBAAQC,GAAR,CAAY,kBAAkBR,GAA9B;AACH,SAHD,MAGO;AACHO,oBAAQC,GAAR,CAAY,kBAAkBL,QAA9B;AACA,gBAAIM,YAAYP,MAAMO,SAAN,CAAgB,CAAhB,CAAhB;AACA,gBAAIC,eAAeD,UAAUE,IAA7B;AACA,gBAAIC,UAAU,oBAAoBH,UAAUI,gBAA5C;AACA;AACAxB,eAAGyB,MAAH,CAAUJ,YAAV,EAAwBE,OAAxB,EAAiC,UAAUZ,GAAV,EAAe;AAC5C,oBAAIA,GAAJ,EAAS;AACLO,4BAAQC,GAAR,CAAY,mBAAmBR,GAA/B;AACH,iBAFD,MAEO;AACHO,4BAAQC,GAAR,CAAY,WAAZ;AACH;AACJ,aAND;AAOA1B,iBAAKiC,SAAL,CAAevB,GAAf,EAAoBiB,UAAUI,gBAAV,GAA6B,QAAjD;AACH;AAGJ,KAvBD;AAwBH,CApCD;;AAsCAG,OAAOC,OAAP,GAAiBhC,MAAjB","file":"file.js","sourcesContent":["import * as RESP from '../core/resp_func';\r\n\r\n//1.首先加载express\r\nlet express = require('express');\r\n//2.获取路由\r\nlet router = express.Router();\r\nvar multiparty = require('multiparty');\r\nvar util = require('util');\r\nvar fs = require('fs');\r\n\r\n//3.对路由对象进行get post方法的配置\r\nrouter.post('/upload', function (req, res, next) {\r\n    // 解析一个文件上传\r\n    var form = new multiparty.Form();\r\n    //设置编辑\r\n    form.encoding = 'utf-8';\r\n    //设置文件存储路径\r\n    form.uploadDir = 'C:\\\\Users\\\\keep2iron\\\\Desktop\\\\Server\\\\public\\\\files';\r\n    //设置单文件大小限制\r\n    form.maxFilesSize = 2 * 1024 * 1024;\r\n    //form.maxFields = 1000;  设置所以文件的大小总和\r\n    //生成multiparty对象，并配置上传目标路径\r\n    //上传完成后处理\r\n    form.parse(req, function (err, fields, files) {\r\n        var filesTmp = JSON.stringify(files, null, 2);\r\n\r\n        if (err) {\r\n            RESP.onFileUploadError(res);\r\n            console.log('parse error: ' + err);\r\n        } else {\r\n            console.log('parse files: ' + filesTmp);\r\n            var inputFile = files.inputFile[0];\r\n            var uploadedPath = inputFile.path;\r\n            var dstPath = './public/files/' + inputFile.originalFilename;\r\n            //重命名为真实文件名\r\n            fs.rename(uploadedPath, dstPath, function (err) {\r\n                if (err) {\r\n                    console.log('rename error: ' + err);\r\n                } else {\r\n                    console.log('rename ok');\r\n                }\r\n            });\r\n            RESP.onSuccess(res, inputFile.originalFilename + '文件上传成功');\r\n        }\r\n\r\n\r\n    });\r\n});\r\n\r\nmodule.exports = router;\r\n"]}